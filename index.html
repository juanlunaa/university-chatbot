<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CampusBot â€“ Comfenalco Cedesarrollo</title>
<link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/Comfenalco_logo.svg/1200px-Comfenalco_logo.svg.png" type="image/png"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --red:#C0131A;
  --red-dark:#8B0E13;
  --red-soft:#f5e6e7;
  --blue:#1B3A8C;
  --blue-mid:#2550C0;
  --blue-soft:#e8edf8;
  --white:#FFFFFF;
  --off-white:#F4F6FB;
  --gray:#E8EBF4;
  --gray2:#C8CEDF;
  --text:#0F1B3D;
  --text-muted:#6B7899;
  --radius:16px;
  --shadow:0 2px 16px rgba(27,58,140,.10);
}
body{
  font-family:'Segoe UI',system-ui,sans-serif;
  background:var(--off-white);
  color:var(--text);
  height:100dvh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.wrapper{
  width:100%;max-width:760px;height:100dvh;
  display:flex;flex-direction:column;
  background:var(--white);
  box-shadow:0 0 40px rgba(27,58,140,.12);
}

/* â”€â”€ HEADER â”€â”€ */
header{
  display:flex;align-items:center;gap:13px;
  padding:14px 22px;
  background:var(--white);
  border-bottom:1px solid var(--gray);
  flex-shrink:0;
}
.logo-wrap{
  width:44px;height:44px;border-radius:50%;
  background:var(--white);
  border:2px solid var(--gray);
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;flex-shrink:0;
  box-shadow:var(--shadow);
}
.logo-wrap img{width:36px;height:36px;object-fit:contain;}
.header-info h1{font-size:.95rem;font-weight:700;color:var(--text);letter-spacing:-.01em;}
.header-info p{font-size:.7rem;color:var(--text-muted);margin-top:1px;display:flex;align-items:center;gap:5px;}
.status-dot{width:7px;height:7px;border-radius:50%;background:#22c55e;display:inline-block;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.35}}
.header-badge{
  margin-left:auto;
  background:var(--blue-soft);color:var(--blue);
  font-size:.68rem;font-weight:600;
  padding:4px 10px;border-radius:20px;letter-spacing:.02em;
  white-space:nowrap;
}

/* â”€â”€ MAP â”€â”€ */
.map-panel{
  flex-shrink:0;padding:14px 20px 12px;
  background:var(--off-white);
  border-bottom:1px solid var(--gray);
}
.map-label{
  font-size:.68rem;font-weight:600;color:var(--text-muted);
  text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px;
  display:flex;align-items:center;gap:5px;
}
.campus-svg{width:100%;height:auto;max-height:200px;}

/* SVG */
.blk-shape{
  fill:var(--white);stroke:var(--gray2);stroke-width:1.5;
  transition:fill .25s,stroke .25s,filter .25s;
  filter:drop-shadow(0 1px 3px rgba(27,58,140,.06));
}
.blk-letter{
  fill:var(--text-muted);font-size:13px;font-weight:700;
  font-family:'Segoe UI',sans-serif;
  dominant-baseline:middle;text-anchor:middle;
  transition:fill .25s;pointer-events:none;
}
.blk-sub{
  fill:var(--gray2);font-size:7.5px;
  font-family:'Segoe UI',sans-serif;
  dominant-baseline:middle;text-anchor:middle;
  pointer-events:none;
}
[data-blk]{cursor:pointer;}
[data-blk]:hover .blk-shape{fill:var(--blue-soft);stroke:var(--blue-mid);}
[data-blk]:hover .blk-letter{fill:var(--blue);}
[data-blk].active .blk-shape{
  fill:var(--blue);stroke:var(--blue-dark,#1B3A8C);stroke-width:2;
  filter:drop-shadow(0 0 8px rgba(27,58,140,.35));
}
[data-blk].active .blk-letter{fill:var(--white);}
[data-blk].active .blk-sub{fill:rgba(255,255,255,.6);}
.campus-outer{fill:none;stroke:var(--gray2);stroke-width:1.5;}

/* â”€â”€ CHAT â”€â”€ */
#chat{
  flex:1;overflow-y:auto;
  padding:20px 20px;
  display:flex;flex-direction:column;gap:14px;
  scroll-behavior:smooth;
  background:var(--white);
}
#chat::-webkit-scrollbar{width:4px;}
#chat::-webkit-scrollbar-thumb{background:var(--gray2);border-radius:4px;}

.msg{display:flex;gap:9px;max-width:88%;animation:fadeUp .2s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.msg.user{align-self:flex-end;flex-direction:row-reverse;}
.msg.bot{align-self:flex-start;}

.msg-av{
  width:30px;height:30px;border-radius:50%;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;
}
.msg.bot .msg-av{background:var(--white);border:1.5px solid var(--gray);}
.msg.bot .msg-av img{width:22px;height:22px;object-fit:contain;}
.msg.user .msg-av{background:var(--red);font-size:13px;}

.bubble{
  padding:11px 15px;border-radius:var(--radius);
  font-size:.86rem;line-height:1.6;
}
.msg.bot .bubble{
  background:var(--off-white);color:var(--text);
  border-radius:4px var(--radius) var(--radius) var(--radius);
  border:1px solid var(--gray);
}
.msg.user .bubble{
  background:var(--blue);color:var(--white);
  border-radius:var(--radius) 4px var(--radius) var(--radius);
}

/* Place card */
.place-card{
  margin-top:9px;background:var(--white);
  border:1px solid var(--gray);
  border-left:3px solid var(--red);
  border-radius:12px;padding:12px 14px;font-size:.83rem;
}
.place-card .pname{font-weight:700;font-size:.9rem;color:var(--red);margin-bottom:6px;}
.place-card .ploc{color:var(--text-muted);line-height:1.55;margin-bottom:4px;}
.place-card .ploc strong{color:var(--text);}
.place-card .pnote{
  font-size:.77rem;color:var(--text-muted);
  border-top:1px solid var(--gray);padding-top:7px;margin-top:7px;
  line-height:1.5;
}
.map-btn{
  margin-top:9px;
  background:transparent;border:1.5px solid var(--blue);
  color:var(--blue);padding:5px 13px;border-radius:20px;
  font-size:.75rem;font-weight:600;cursor:pointer;
  transition:background .2s,color .2s;
}
.map-btn:hover{background:var(--blue);color:var(--white);}

/* Suggestions */
.suggestions{display:flex;flex-wrap:wrap;gap:6px;margin-top:9px;}
.sug-btn{
  background:var(--white);border:1.5px solid var(--gray2);
  color:var(--text);padding:5px 12px;border-radius:20px;
  font-size:.76rem;font-weight:500;cursor:pointer;
  transition:background .18s,border-color .18s,color .18s;
}
.sug-btn:hover{background:var(--blue-soft);border-color:var(--blue-mid);color:var(--blue);}

/* Typing */
.typing{display:flex;align-items:center;gap:4px;padding:8px 12px;}
.typing span{width:6px;height:6px;background:var(--gray2);border-radius:50%;animation:bounce .9s infinite;}
.typing span:nth-child(2){animation-delay:.15s;}
.typing span:nth-child(3){animation-delay:.3s;}
@keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-5px)}}

/* â”€â”€ INPUT â”€â”€ */
.input-area{
  padding:12px 18px;
  background:var(--white);
  border-top:1px solid var(--gray);
  display:flex;gap:9px;align-items:center;
  flex-shrink:0;
}
#userInput{
  flex:1;background:var(--off-white);
  border:1.5px solid var(--gray2);border-radius:24px;
  padding:10px 18px;color:var(--text);
  font-size:.86rem;outline:none;
  transition:border-color .2s,background .2s;
}
#userInput:focus{border-color:var(--blue-mid);background:var(--white);}
#userInput::placeholder{color:var(--text-muted);}
#sendBtn{
  width:42px;height:42px;border-radius:50%;border:none;
  background:var(--red);color:var(--white);
  font-size:16px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
  transition:background .2s,transform .1s;
  box-shadow:0 2px 8px rgba(192,19,26,.25);
}
#sendBtn:hover{background:var(--red-dark);}
#sendBtn:active{transform:scale(.93);}
</style>
</head>
<body>
<div class="wrapper">

  <!-- HEADER -->
  <header>
    <div class="logo-wrap">
      <img id="logoImg" src="" alt="Comfenalco"/>
    </div>
    <div class="header-info">
      <h1>CampusBot</h1>
      <p><span class="status-dot"></span>En lÃ­nea Â· Listo para orientarte</p>
    </div>
    <span class="header-badge">ğŸ“ Sede B â€“ Cedesarrollo</span>
  </header>

  <!-- MAP -->
  <div class="map-panel">
    <div class="map-label">
      <svg width="12" height="12" viewBox="0 0 12 12"><circle cx="6" cy="6" r="5.5" fill="none" stroke="#6B7899" stroke-width="1"/><circle cx="6" cy="5" r="2" fill="#6B7899"/><path d="M6 7.5c-2 0-3.5.8-3.5 1.5h7c0-.7-1.5-1.5-3.5-1.5z" fill="#6B7899"/></svg>
      Plano del campus â€” toca un bloque para explorar
    </div>
    <svg class="campus-svg" viewBox="0 0 500 220" xmlns="http://www.w3.org/2000/svg">
      <rect class="campus-outer" x="4" y="4" width="492" height="212" rx="18"/>

      <g data-blk="A" id="blk-A">
        <rect class="blk-shape" x="14" y="12" width="148" height="58" rx="10"/>
        <text class="blk-letter" x="88" y="36">A</text>
        <text class="blk-sub" x="88" y="52">Biblioteca Â· Bienestar Â· Dir.</text>
      </g>

      <g data-blk="C" id="blk-C">
        <rect class="blk-shape" x="170" y="12" width="322" height="58" rx="10"/>
        <text class="blk-letter" x="331" y="36">C</text>
        <text class="blk-sub" x="331" y="52">Salones C101 â€“ C605</text>
      </g>

      <g data-blk="F" id="blk-F">
        <rect class="blk-shape" x="170" y="80" width="118" height="98" rx="10"/>
        <text class="blk-letter" x="229" y="124">F</text>
        <text class="blk-sub" x="229" y="141">Auditorio</text>
      </g>

      <g data-blk="D" id="blk-D">
        <rect class="blk-shape" x="366" y="80" width="126" height="98" rx="10"/>
        <text class="blk-letter" x="429" y="124">D</text>
        <text class="blk-sub" x="429" y="141">Salones Â· BaÃ±os</text>
      </g>

      <g data-blk="E" id="blk-E">
        <rect class="blk-shape" x="170" y="186" width="322" height="26" rx="8"/>
        <text class="blk-letter" x="280" y="199">E</text>
        <text class="blk-sub" x="420" y="199">Labs Â· CÃ³mputo</text>
      </g>

      <g data-blk="ENTRADA" id="blk-ENTRADA">
        <rect class="blk-shape" x="14" y="186" width="100" height="26" rx="7"/>
        <text class="blk-letter" style="font-size:8.5px" x="64" y="199">ENTRADA</text>
      </g>
    </svg>
  </div>

  <!-- CHAT -->
  <div id="chat"></div>

  <!-- INPUT -->
  <div class="input-area">
    <input id="userInput" type="text" placeholder="Escribe un salÃ³n (ej: E402) o quÃ© lugar buscasâ€¦" autocomplete="off"/>
    <button id="sendBtn" title="Enviar">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
    </button>
  </div>
</div>

<script>
// â”€â”€ Logo: embed the Comfenalco logo as base64-like URL â”€â”€
// We use the actual uploaded image encoded inline via canvas trick or just reference SVG inline
// Using the public CDN image as src
document.getElementById("logoImg").src =
  "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='48' fill='white' stroke='%231B3A8C' stroke-width='4'/><path d='M50 15 C30 15 15 30 15 50 C15 68 28 82 45 84 L45 72 C35 70 27 61 27 50 C27 37 37 27 50 27 C63 27 73 37 73 50 C73 61 65 70 55 72 L55 84 C72 82 85 68 85 50 C85 30 70 15 50 15Z' fill='%23C0131A'/><rect x='44' y='38' width='5' height='32' rx='2' fill='%23C0131A'/><rect x='51' y='38' width='5' height='24' rx='2' fill='%23C0131A'/><circle cx='50' cy='12' r='4' fill='%231B3A8C'/></svg>";

// â”€â”€ KNOWLEDGE BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const places = [
  {id:"salones_a",name:"Salones Bloque A",emoji:"ğŸšª",blk:"A",
   locations:[{label:"Salones A101â€“A105",detail:"Bloque A, Piso 1 Â· Ãºnica planta con aulas en este bloque"}],
   notes:"El Bloque A solo tiene salones de clase en el Piso 1. Los pisos superiores estÃ¡n destinados a Biblioteca, CafeterÃ­a y DirecciÃ³n.",
   keywords:["salon a","salones a","bloque a","clase a","aula a","a101","a102","a103","a104","a105"]},

  {id:"salones_c",name:"Salones Bloque C",emoji:"ğŸšª",blk:"C",
   locations:[{label:"Salones C101â€“C605",detail:"Bloque C, Pisos 1 al 6"}],
   notes:"Accede por el corredor principal en cada piso.",
   keywords:["salon c","salones c","bloque c","clase c","c101","c201","c301","c401","c501","c601","c1","c2","c3","c4","c5","c6"]},

  {id:"salones_d",name:"Salones Bloque D",emoji:"ğŸšª",blk:"D",
   locations:[{label:"Salones D101â€“D605",detail:"Bloque D, Pisos 1 al 6"}],
   notes:"En ambos extremos del Bloque D encontrarÃ¡s baÃ±os en todos los pisos.",
   keywords:["salon d","salones d","bloque d","clase d","d101","d201","d301","d401","d501","d601","d1","d2","d3","d4","d5","d6"]},

  {id:"lab_computo",name:"Laboratorios de CÃ³mputo",emoji:"ğŸ’»",blk:"E",
   locations:[{label:"Lab. CÃ³mputo E101â€“E305",detail:"Bloque E, Pisos 1, 2 y 3 Â· Entrada Ãºnica por Piso 1"}],
   notes:"âš ï¸ La Ãºnica entrada es por el Piso 1. En la entrada de cada piso encontrarÃ¡s la Sala de Sistemas.",
   keywords:["laboratorio computo","lab computo","computador","computadora","pc","sistemas","informatica","e101","e201","e301","e1","e2","e3","internet","software","sala sistemas","sala de sistemas"]},

  {id:"laboratorios",name:"Laboratorios",emoji:"ğŸ”¬",blk:"E",
   locations:[{label:"Laboratorios E401â€“E505",detail:"Bloque E, Pisos 4 y 5 Â· Entrada Ãºnica por Piso 4"}],
   notes:"âš ï¸ La Ãºnica entrada para los pisos 4 y 5 del Bloque E es en el Piso 4.",
   keywords:["laboratorio","lab","practica","experimento","quimica","fisica","biologia","e401","e501","e4","e5"]},

  {id:"biblioteca",name:"Biblioteca",emoji:"ğŸ“š",blk:"A",
   locations:[{label:"Biblioteca",detail:"Bloque A, Piso 2 Â· entrada Ãºnica Â· se extiende hasta Piso 3"}],
   notes:"Puedes apartar Salones Semillero aquÃ­. Entrada solo por Piso 2.",
   keywords:["biblioteca","libro","libros","prestar","estudiar","leer","investigar","semillero","salon semillero","apartar salon","referencia","lectura"]},

  {id:"direccion",name:"DirecciÃ³n de Programa",emoji:"ğŸ“‹",blk:"A",
   locations:[{label:"DirecciÃ³n de Programa",detail:"Bloque A, Piso 4"}],
   notes:"El Bloque A llega hasta el Piso 4 (no existen pisos 5 ni 6 en este bloque).",
   keywords:["direccion","director","programa","coordinacion","coordinador","tramite","certificado","paz y salvo","grado","matricula","nota","registro","secretaria"]},

  {id:"bienestar",name:"Bienestar Universitario",emoji:"ğŸ§ ",blk:"A",
   locations:[{label:"Bienestar Universitario",detail:"Bloque A, Piso 1"}],
   notes:"AtenciÃ³n psicolÃ³gica, orientaciÃ³n acadÃ©mica y apoyo socioeconÃ³mico.",
   keywords:["bienestar","psicologo","psicologia","salud","medico","apoyo","orientacion","beca","asesoria","estres","ansiedad","enfermeria"]},

  {id:"auditorio",name:"Auditorio",emoji:"ğŸ­",blk:"F",
   locations:[{label:"Auditorio",detail:"Bloque F, Piso 1 Â· ocupa todo el bloque"}],
   notes:"Ideal para conferencias, eventos acadÃ©micos y culturales.",
   keywords:["auditorio","evento","conferencia","charla","presentacion","exposicion","teatro","concierto","seminario","bloque f"]},

  {id:"banos",name:"BaÃ±os",emoji:"ğŸš»",blk:"D",
   locations:[{label:"BaÃ±os",detail:"Bloque D Â· ambos extremos, todos los pisos (1â€“6)"}],
   notes:"Disponibles en cada extremo del Bloque D en los 6 pisos.",
   keywords:["baÃ±o","baÃ±os","sanitario","wc","servicio","bano","higienico"]},

  {id:"cafeteria",name:"CafeterÃ­a y Zona Social",emoji:"â˜•",blk:"A",
   locations:[{label:"CafeterÃ­a / Zona social",detail:"Bloque A, Pisos 2 en adelante (Ã¡rea social)"}],
   notes:"Espacios de descanso, mesas y cafeterÃ­a en el Bloque A, fuera de las Ã¡reas acadÃ©micas.",
   keywords:["cafeteria","cafe","comer","almuerzo","desayuno","hambre","comida","merienda","snack","zona social","descanso","mesa"]},

  {id:"entrada",name:"Entrada Principal",emoji:"ğŸšª",blk:"ENTRADA",
   locations:[{label:"Entrada",detail:"Costado inferior izquierdo del campus"}],
   notes:"Acceso principal de la Sede B â€“ Cedesarrollo.",
   keywords:["entrada","acceso","puerta","porteria","ingreso","salida"]}
];

// â”€â”€ MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function highlightBlock(blkId){
  document.querySelectorAll(".campus-svg [data-blk]").forEach(el=>el.classList.remove("active"));
  if(blkId){const el=document.getElementById("blk-"+blkId);if(el){el.classList.add("active");}}
}

document.querySelectorAll(".campus-svg [data-blk]").forEach(el=>{
  el.addEventListener("click",()=>{
    const blk=el.getAttribute("data-blk");
    highlightBlock(blk);
    const rel=places.filter(p=>p.blk===blk);
    if(!rel.length) return;
    const label=blk==="ENTRADA"?"la Entrada":`el Bloque ${blk}`;
    addMsg(`SeleccionÃ© ${label}`,"user");
    showTyping();
    if(rel.length===1){
      setTimeout(()=>{hideTyping();addMsg(buildCard(rel[0],null),"bot");},500);
    } else {
      setTimeout(()=>{
        hideTyping();
        const opts=rel.map(p=>`<button class="sug-btn" data-pid="${p.id}">${p.emoji} ${p.name}</button>`).join("");
        addMsg(`El <strong>Bloque ${blk}</strong> tiene varios espacios. Â¿CuÃ¡l necesitas?<div class="suggestions">${opts}</div>`,"bot");
      },500);
    }
  });
});

// â”€â”€ INTENT & SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const greetings=["hola","hi","buenos dÃ­as","buenas tardes","buenas noches","buenas","hey","saludos","quÃ© tal","como estas","buen dia"];
const helpWords=["ayuda","que puedes","como funciona","que haces","opciones","menu"];
const thanks=["gracias","muchas gracias","ok gracias","perfecto","genial","listo"];

function norm(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");}

function detectIntent(text){
  const t=norm(text);
  if(greetings.some(g=>t.includes(norm(g)))) return "greeting";
  if(helpWords.some(h=>t.includes(norm(h))))  return "help";
  if(thanks.some(k=>t.includes(norm(k))))     return "thanks";
  if(/\b[acdef]\d{3}\b/i.test(text))          return "salon_code";
  return "location";
}

function findBySalonCode(text){
  const m=text.match(/\b([acdef])(\d)(\d{2})\b/i);
  if(!m) return null;
  const blk=m[1].toUpperCase(),floor=parseInt(m[2]);
  if(blk==="E"&&floor>=4) return places.find(p=>p.id==="laboratorios");
  if(blk==="E"&&floor<=3) return places.find(p=>p.id==="lab_computo");
  if(blk==="A") return places.find(p=>p.id==="salones_a");
  if(blk==="C") return places.find(p=>p.id==="salones_c");
  if(blk==="D") return places.find(p=>p.id==="salones_d");
  if(blk==="F") return places.find(p=>p.id==="auditorio");
  return null;
}

function findPlace(text){
  const t=norm(text);
  let best=null,bestScore=0;
  for(const p of places){
    let score=0;
    for(const kw of p.keywords){if(t.includes(norm(kw))) score++;}
    if(score>bestScore){bestScore=score;best=p;}
  }
  return bestScore>0?best:null;
}

// â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildCard(place,code){
  highlightBlock(place.blk);
  const locs=place.locations.map(l=>`<div class="ploc"><strong>ğŸ“ ${l.label}</strong><br>${l.detail}</div>`).join("");
  const note=place.notes?`<div class="pnote">â„¹ï¸ ${place.notes}</div>`:"";
  const header=code?`El salÃ³n <strong>${code.toUpperCase()}</strong> estÃ¡ aquÃ­ ğŸ“`:`Â¡EncontrÃ© el lugar! ğŸ“`;
  return `${header}
<div class="place-card">
  <div class="pname">${place.emoji} ${place.name}</div>
  ${locs}${note}
  <button class="map-btn" onclick="highlightBlock('${place.blk}')">Ver en el mapa</button>
</div>`;
}

// â”€â”€ REPLIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const greetR=[
  "Â¡Hola! ğŸ‘‹ Soy CampusBot, tu guÃ­a en la <strong>Sede B â€“ Cedesarrollo</strong>. Toca un bloque en el mapa o cuÃ©ntame quÃ© lugar buscas.",
  "Â¡Bienvenido/a! ğŸ˜Š Escribe el cÃ³digo de tu salÃ³n (ej: <em>E402</em>) o dime quÃ© necesitas y te oriento.",
  "Â¡Hola! Estoy aquÃ­ para ayudarte a moverte por el campus. Usa el mapa o escrÃ­beme. ğŸ“"
];
const helpHTML=`Puedo orientarte por la <strong>Sede B â€“ Cedesarrollo</strong>. Toca un bloque en el mapa o pregÃºntame por alguno de estos espacios:<div class="suggestions">
<button class="sug-btn">ğŸ“š Biblioteca</button>
<button class="sug-btn">ğŸ’» Lab. de cÃ³mputo</button>
<button class="sug-btn">ğŸ”¬ Laboratorios</button>
<button class="sug-btn">ğŸ­ Auditorio</button>
<button class="sug-btn">ğŸ§  Bienestar universitario</button>
<button class="sug-btn">ğŸš» BaÃ±os</button>
<button class="sug-btn">â˜• CafeterÃ­a</button>
<button class="sug-btn">ğŸ“‹ DirecciÃ³n de programa</button>
</div>`;
const thanksR=["Â¡Con gusto! AquÃ­ estoy si necesitas algo mÃ¡s. ğŸ˜Š","Â¡Para eso estoy! Buen dÃ­a en el campus. ğŸ“","Â¡De nada! Cualquier duda, con gusto. ğŸ‘"];
const notFound=`No logrÃ© identificar el lugar. ğŸ¤” Prueba con el <strong>cÃ³digo del salÃ³n</strong> (ej: <em>E402</em>, <em>C203</em>) o toca directamente un bloque en el mapa.`;

function getReply(text){
  const intent=detectIntent(text);
  // check place id from suggestion
  const byId=places.find(p=>norm(text)===norm(p.name)||norm(text)===p.id);
  if(byId) return buildCard(byId,null);
  if(intent==="greeting") return greetR[Math.floor(Math.random()*greetR.length)];
  if(intent==="help")     return helpHTML;
  if(intent==="thanks")   return thanksR[Math.floor(Math.random()*thanksR.length)];
  if(intent==="salon_code"){
    const m=text.match(/\b([acdef]\d{3})\b/i);
    const p=findBySalonCode(text);
    return p?buildCard(p,m?m[1]:null):notFound;
  }
  const p=findPlace(text);
  return p?buildCard(p,null):notFound;
}

// â”€â”€ DOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const chat=document.getElementById("chat");
const input=document.getElementById("userInput");
const btn=document.getElementById("sendBtn");

function addMsg(html,who){
  const msg=document.createElement("div"); msg.className=`msg ${who}`;
  const av=document.createElement("div"); av.className="msg-av";
  if(who==="bot"){
    const img=document.createElement("img");
    img.src=document.getElementById("logoImg").src;
    img.style="width:22px;height:22px;object-fit:contain;";
    av.appendChild(img);
  } else {
    av.textContent="ğŸ§‘";
  }
  const bub=document.createElement("div"); bub.className="bubble"; bub.innerHTML=html;
  msg.appendChild(av); msg.appendChild(bub); chat.appendChild(msg);
  chat.scrollTop=chat.scrollHeight;
  bub.querySelectorAll(".sug-btn").forEach(b=>{
    b.addEventListener("click",()=>{
      const pid=b.getAttribute("data-pid");
      if(pid){
        const place=places.find(p=>p.id===pid);
        if(place){addMsg(place.name,"user");showTyping();setTimeout(()=>{hideTyping();addMsg(buildCard(place,null),"bot");},500);}
      } else {
        handleSend(b.textContent.replace(/^[^\w]+/,"").trim());
      }
    });
  });
}

function showTyping(){
  const el=document.createElement("div"); el.className="msg bot"; el.id="typing";
  const av=document.createElement("div"); av.className="msg-av";
  const img=document.createElement("img");
  img.src=document.getElementById("logoImg").src;
  img.style="width:22px;height:22px;object-fit:contain;";
  av.appendChild(img);
  const bub=document.createElement("div"); bub.className="bubble";
  bub.innerHTML=`<div class="typing"><span></span><span></span><span></span></div>`;
  el.appendChild(av); el.appendChild(bub); chat.appendChild(el);
  chat.scrollTop=chat.scrollHeight;
}
function hideTyping(){document.getElementById("typing")?.remove();}

function handleSend(text){
  const t=(text||input.value).trim(); if(!t) return;
  input.value=""; addMsg(t,"user"); showTyping();
  setTimeout(()=>{hideTyping();addMsg(getReply(t),"bot");},600+Math.random()*300);
}

btn.addEventListener("click",()=>handleSend());
input.addEventListener("keydown",e=>{if(e.key==="Enter") handleSend();});

setTimeout(()=>{
  addMsg(`Â¡Hola! ğŸ‘‹ Soy <strong>CampusBot</strong>, tu guÃ­a en la <strong>Sede B â€“ Cedesarrollo</strong> del TecnolÃ³gico Comfenalco.<br><br>
Toca un <strong>bloque en el mapa</strong> o escribe el cÃ³digo de tu salÃ³n (ej: <em>E402</em>, <em>C301</em>):<div class="suggestions">
<button class="sug-btn">ğŸ“š Biblioteca</button>
<button class="sug-btn">ğŸ’» Lab. de cÃ³mputo</button>
<button class="sug-btn">ğŸ”¬ Laboratorios</button>
<button class="sug-btn">ğŸ­ Auditorio</button>
<button class="sug-btn">ğŸ§  Bienestar</button>
<button class="sug-btn">ğŸš» BaÃ±os</button>
</div>`,"bot");
},400);
</script>
</body>
</html>
